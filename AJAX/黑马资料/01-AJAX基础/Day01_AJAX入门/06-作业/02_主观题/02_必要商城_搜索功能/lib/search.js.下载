var classifyGuy={getMore:function(e){var t=e.moreEle,a=1,o=function(){a=0,$.ajax({type:"get",url:e.url,data:e.params,contentType:"application/json",dataType:e.dataType||"json",jsonpCallback:e.jsonpCallback||null,success:function(o){if(o.success){if(300==o.data.resultType)return;e.params.pageIndex++,e.callback(o),e.showMoreEle(o)?t.remove():a=1}else t.html(o.error.message)},error:function(){t.html("网络请求失败！")}})};t.length&&$(window).on("scroll",function(){($("body").scrollTop()||document.documentElement.scrollTop)-t.offset().top+$(window).height()>=0&&a&&o()})},search:function(){var e=this,t=$(".category-list"),a=function(){for(var e,t=window.location.search.slice(1).split("&"),a=0;a<t.length;a++)"query"==t[a].split("=")[0]&&(e=t[a].split("=")[1]);return decodeURIComponent(e)}(),o=function(e){var t=encodeURIComponent("pos="+encodeURIComponent(e.position)+"&sid="+encodeURIComponent(r.sid)+"&q="+a),o='<li><a target="_blank" href="'+ControllerSite+"/products/"+e.suId+"-0.html?ass="+t+'"><i><img src="'+e.image+'"/></i>';1==e.isNew&&(o+="<b></b>"),e.supplierBackground&&(o+='<div class="supplier">'+e.supplierBackground.slice(0,21)+"</div>"),o+='<div class="title">'+e.name.slice(0,21)+'</div><div class="priceBox"><div class="price" price="'+e.priceStr+'"></div><div class="mack">';for(var i=0;2>i&&e.lables[i];i++)o+='<span style="color:'+e.lables[i].textColor+";background:"+e.lables[i].color+"; border-color:"+e.lables[i].roundColor+'">'+e.lables[i].content+"</span>";return o+="</div></div>",o+='<div class="evaluate">'+e.commentInfo+"</div>",o+="</a></li>",$(o)},r={sid:"",pvid:"",ubid:"3-"+(new Date).getTime()+"-"+cipher($.cookie("uuid")).substring(0,16),platform:"pc",uuid:$.cookie("uuid")||masterGuy.randomStr(36),uid:$.cookie("uid")||"",appVersion:"",device:"",osVersion:"",deviceWidth:window.screen.width,deviceHeight:window.screen.height,query:a,pageIndex:1},i=function(e,t){return e.length>t?e.slice(0,t)+"...":e},n=function(e){var t=/\<|\>|\"|\'|\&/g;return e=e.replace(t,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";case"&":return"&amp;"}})};$("#searchInput").val(decodeURIComponent(a)),$.ajax({url:window.ControllerSite+"/classify/goSearch",type:"POST",data:r,success:function(s){if(1==s.success)if(300==s.data.resultType)$(".search-noResult").show().find("dt").html("您寻找的“"+i(n(decodeURIComponent(a)),10)+"”还未上架"),e.getHot(),$("#moreProduct").hide();else{$(".bread").append("<span><b>&gt;</b>"+i(n(decodeURIComponent(a)),10)+"</span>"),$(".cateBread").append("根据您搜索的“"+i(n(decodeURIComponent(a)),10)+"”，为您匹配到以下商品："),$(".search-result").show(),r.sid=s.data.sid,r.pageIndex++;for(var c=0;c<s.data.products.length;c++)t.append(o(s.data.products[c]));e.dataInfo(),s.data.pageCount==s.data.pageIndex&&$("#moreProduct").hide(),s.data.pageCount>1&&e.getMore({moreEle:$("#moreProduct"),url:"/classify/goSearch",params:r,callback:function(a){for(var r=0;r<a.data.products.length;r++)t.append(o(a.data.products[r]));e.dataInfo(),a.data.pageCount==a.data.pageIndex&&$("#moreProduct").hide()},showMoreEle:function(e){return e.data.pageIndex>=e.data.pageCount}})}}})},getUUID:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+e()+e()+e()+e()+e()+e()},getHot:function(){var e=this;$.ajax({type:"get",url:window.ControllerSite+"/home/getMoreModule",data:{pageIndex:1,pageSize:20,type:2,pvId:e.getUUID()},contentType:"application/json",success:function(t){if(t.success){for(var a=0;a<t.data.productList.length;a++)$(".category-list").append(e.setItem(t.data.productList[a]));$.each($(".price"),function(){$(this).html(rePrice({price:$(this).attr("price"),color:"#F7A701",max:18,min:12}))}),$.each($(".supplier"),function(){$(this).html($(this).text().slice(0,21))}),$.each($(".title"),function(){$(this).html($(this).text().slice(0,21))})}else moreEle.html(t.error.message)},error:function(){moreEle.html("网络请求失败！")}})},setItem:function(e){var t='<li><a target="_blank" href="'+ControllerSite+"/products/"+e.suId+'-0.html"><i><img src="'+e.imageUrl+'"/></i>';1==e.isNew&&(t+="<b></b>"),e.supplierBackground&&(t+='<div class="supplier">'+e.supplierBackground.slice(0,21)+"</div>"),t+='<div class="title">'+e.title.slice(0,21)+'</div><div class="priceBox"><div class="price" price="'+e.priceStr+'"></div><div class="mack">';for(var a=0;2>a&&e.labels[a];a++)t+='<span style="color:'+e.labels[a].textColor+";background:"+e.labels[a].color+"; border-color:"+e.labels[a].roundColor+'">'+e.labels[a].content+"</span>";return t+="</div></div>",e.evaluate&&(t+='<div class="evaluate">'+e.evaluate+"</div>"),t+="</a></li>",$(t)},dataInfo:function(){$.each($(".price"),function(){$(this).html(rePrice({price:$(this).attr("price"),color:"#F7A701",max:18,min:12}))}),$.each($(".supplier"),function(){$(this).html($(this).text().slice(0,21))}),$.each($(".title"),function(){$(this).html($(this).text().slice(0,21))})}};